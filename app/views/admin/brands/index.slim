.page-header
  h4 品牌信息
  - if @brand.new_record?
    .well 品牌信息是在一个PDF格式文件，请上传，大小不超过20M。
noscript
= simple_form_for @brand, :url => @brand.new_record? ? admin_brands_path : admin_brand_path(@brand),:html => {class: 'form-horizontal', enctype: 'multipart/form-data', id: "fileupload"} do |f|
  table style="width:100%;"
    - unless @brand.full_pdf_url.empty?
      tr
        td
          | 文件上传时间：
          span id="last-updated-at"
            = t2l @brand.updated_at
        td
          span id="download-link"
            = link_to '点击下载', @brand.full_pdf_url, target: '_blank'
    tr.fileupload-buttonbar
      td.span3
        span.btn.btn-primary.fileinput-button
          i class="icon-plus icon-white"
          span 上传PDF文件
          |  <input type="file" name="brand[pdf]">
      td.span9.fileupload-progress.fade
        .progress.progress-success.progress-striped.active role="progressbar" aria-valuemin="0" aria-valuemax="100"
          .bar style="width:0%;"
        .progress-extended &nbsp;
        .fileupload-loading
= render :partial => 'shared/file_upload'
- content_for :footer do
  javascript:
    $(document).ready(function(){
      $('#fileupload').fileupload();
      $('#fileupload').fileupload('option', {
        maxFileSize:20000000, // 20M
        acceptFileTypes:/(\.|\/)(pdf)$/i,
        autoUpload: true,
        uploadTemplate: function(o){
          var rows = $();
          $.each(o.files, function (index, file) {
            rows = rows.add($('<span>' + file.error + '</span>'));
          });
          return rows;
        }
      }).bind('fileuploadadded', function(e, data){
        if(!data.isValidated){
          alert(data.context[0].innerHTML);
        }
      }).bind('fileuploaddone', function(e, data){
        alert(data.result.message);
        if(1 == data.result.status){
          $('#last-updated-at').html(data.result.updated_at);
          $('#download-link').html('<a href="'+ data.result.link +'" target="_blank">点击下载</a>');
        }
      });
      if ($.support.cors) {
        $.ajax({
          maxChunkSize:20000000, // 20 MB
          url:$('#fileupload').fileupload('option', 'url'),
          dataType:'json',
          context:$('#fileupload')[0]
        }).always(function (result) {
          $(this).removeClass('fileupload-processing');
        });
      }
    });
